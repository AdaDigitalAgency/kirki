{"mappings":"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","sources":["src/dynamic-control.js"],"sourcesContent":["/**\n * The majority of the code in this file\n * is derived from the wp-customize-posts plugin\n * and the work of @westonruter to whom I am very grateful.\n *\n * @see https://github.com/xwp/wp-customize-posts\n */\n\n(function () {\n\t'use strict';\n\n\t/**\n\t * A dynamic color-alpha control.\n\t *\n\t * @class\n\t * @augments wp.customize.Control\n\t * @augments wp.customize.Class\n\t */\n\twp.customize.kirkiDynamicControl = wp.customize.Control.extend({\n\n\t\tinitialize: function (id, options) {\n\t\t\tvar control = this,\n\t\t\t\targs = options || {};\n\n\t\t\targs.params = args.params || {};\n\t\t\tif (!args.params.type) {\n\t\t\t\targs.params.type = 'kirki-generic';\n\t\t\t}\n\n\t\t\tlet className;\n\n\t\t\tif (args.content) {\n\t\t\t\tlet splits = args.content.split('class=\"');\n\t\t\t\tsplits = splits[1].split('\"');\n\t\t\t\tclassName = splits[0];\n\t\t\t} else {\n\t\t\t\tclassName = 'customize-control customize-control-' + args.params.type;\n\t\t\t}\n\n\t\t\t// Hijack the container to add wrapper_atts.\n\t\t\targs.params.content = jQuery('<li></li>');\n\t\t\targs.params.content.attr('id', 'customize-control-' + id.replace(/]/g, '').replace(/\\[/g, '-'));\n\t\t\targs.params.content.attr('class', className);\n\t\t\t_.each(args.params.wrapper_atts, function (val, key) {\n\t\t\t\tif ('class' === key) {\n\t\t\t\t\tval = val.replace('{default_class}', className);\n\t\t\t\t}\n\n\t\t\t\targs.params.content.attr(key, val);\n\t\t\t});\n\n\t\t\tcontrol.propertyElements = [];\n\t\t\twp.customize.Control.prototype.initialize.call(control, id, args);\n\t\t\twp.hooks.doAction('kirki.dynamicControl.init.after', id, control, args);\n\t\t},\n\n\t\t/**\n\t\t * Add bidirectional data binding links between inputs and the setting(s).\n\t\t *\n\t\t * This is copied from wp.customize.Control.prototype.initialize(). It\n\t\t * should be changed in Core to be applied once the control is embedded.\n\t\t *\n\t\t * @private\n\t\t * @returns {void}\n\t\t */\n\t\t_setUpSettingRootLinks: function () {\n\t\t\tvar control = this,\n\t\t\t\tnodes = control.container.find('[data-customize-setting-link]');\n\n\t\t\tnodes.each(function () {\n\t\t\t\tvar node = jQuery(this);\n\n\t\t\t\twp.customize(node.data('customizeSettingLink'), function (setting) {\n\t\t\t\t\tvar element = new wp.customize.Element(node);\n\t\t\t\t\tcontrol.elements.push(element);\n\t\t\t\t\telement.sync(setting);\n\t\t\t\t\telement.set(setting());\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Add bidirectional data binding links between inputs and the setting properties.\n\t\t *\n\t\t * @private\n\t\t * @returns {void}\n\t\t */\n\t\t_setUpSettingPropertyLinks: function () {\n\t\t\tvar control = this,\n\t\t\t\tnodes;\n\n\t\t\tif (!control.setting) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnodes = control.container.find('[data-customize-setting-property-link]');\n\n\t\t\tnodes.each(function () {\n\t\t\t\tvar node = jQuery(this),\n\t\t\t\t\telement,\n\t\t\t\t\tpropertyName = node.data('customizeSettingPropertyLink');\n\n\t\t\t\telement = new wp.customize.Element(node);\n\t\t\t\tcontrol.propertyElements.push(element);\n\t\t\t\telement.set(control.setting()[propertyName]);\n\n\t\t\t\telement.bind(function (newPropertyValue) {\n\t\t\t\t\tvar newSetting = control.setting();\n\t\t\t\t\tif (newPropertyValue === newSetting[propertyName]) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tnewSetting = _.clone(newSetting);\n\t\t\t\t\tnewSetting[propertyName] = newPropertyValue;\n\t\t\t\t\tcontrol.setting.set(newSetting);\n\t\t\t\t});\n\t\t\t\tcontrol.setting.bind(function (newValue) {\n\t\t\t\t\tif (newValue[propertyName] !== element.get()) {\n\t\t\t\t\t\telement.set(newValue[propertyName]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * @inheritdoc\n\t\t */\n\t\tready: function () {\n\t\t\tvar control = this;\n\n\t\t\tcontrol._setUpSettingRootLinks();\n\t\t\tcontrol._setUpSettingPropertyLinks();\n\n\t\t\twp.customize.Control.prototype.ready.call(control);\n\n\t\t\tcontrol.deferred.embedded.done(function () {\n\t\t\t\tcontrol.initKirkiControl();\n\t\t\t\twp.hooks.doAction('kirki.dynamicControl.ready.deferred.embedded.done', control);\n\t\t\t});\n\t\t\twp.hooks.doAction('kirki.dynamicControl.ready.after', control);\n\t\t},\n\n\t\t/**\n\t\t * Embed the control in the document.\n\t\t *\n\t\t * Override the embed() method to do nothing,\n\t\t * so that the control isn't embedded on load,\n\t\t * unless the containing section is already expanded.\n\t\t *\n\t\t * @returns {void}\n\t\t */\n\t\tembed: function () {\n\t\t\tvar control = this,\n\t\t\t\tsectionId = control.section();\n\n\t\t\tif (!sectionId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twp.customize.section(sectionId, function (section) {\n\t\t\t\tif ('kirki-expanded' === section.params.type || section.expanded() || wp.customize.settings.autofocus.control === control.id) {\n\t\t\t\t\tcontrol.actuallyEmbed();\n\t\t\t\t} else {\n\t\t\t\t\tsection.expanded.bind(function (expanded) {\n\t\t\t\t\t\tif (expanded) {\n\t\t\t\t\t\t\tcontrol.actuallyEmbed();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\twp.hooks.doAction('kirki.dynamicControl.embed.after', control);\n\t\t},\n\n\t\t/**\n\t\t * Deferred embedding of control when actually\n\t\t *\n\t\t * This function is called in Section.onChangeExpanded() so the control\n\t\t * will only get embedded when the Section is first expanded.\n\t\t *\n\t\t * @returns {void}\n\t\t */\n\t\tactuallyEmbed: function () {\n\t\t\tvar control = this;\n\t\t\tif ('resolved' === control.deferred.embedded.state()) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcontrol.renderContent();\n\t\t\tcontrol.deferred.embedded.resolve(); // This triggers control.ready().\n\t\t\twp.hooks.doAction('kirki.dynamicControl.actuallyEmbed.after', control);\n\t\t},\n\n\t\t/**\n\t\t * This is not working with autofocus.\n\t\t *\n\t\t * @param {object} [args] Args.\n\t\t * @returns {void}\n\t\t */\n\t\tfocus: function (args) {\n\t\t\tvar control = this;\n\t\t\tcontrol.actuallyEmbed();\n\t\t\twp.customize.Control.prototype.focus.call(control, args);\n\t\t\twp.hooks.doAction('kirki.dynamicControl.focus.after', control);\n\t\t},\n\n\t\t/**\n\t\t * Additional actions that run on ready.\n\t\t *\n\t\t * @param {object} control - The control object. If undefined fallsback to the this.\n\t\t * @returns {void}\n\t\t */\n\t\tinitKirkiControl: function (control) {\n\t\t\tcontrol = control || this;\n\t\t\twp.hooks.doAction('kirki.dynamicControl.initKirkiControl', this);\n\n\t\t\t// Save the value\n\t\t\tcontrol.container.on('change keyup paste click', 'input', function () {\n\t\t\t\tcontrol.setting.set(jQuery(this).val());\n\t\t\t});\n\t\t}\n\t});\n}());\n\n(function (api) {\n\n\t/**\n\t * Set the value and trigger all bound callbacks.\n\t *\n\t * @since 1.0\n\t * @param {object} to - New value.\n\t * @returns {Object} - this\n\t */\n\tapi.Value.prototype.set = function (to) {\n\t\tvar from = this._value,\n\t\t\tparentSetting,\n\t\t\tnewVal;\n\n\t\tto = this._setter.apply(this, arguments);\n\t\tto = this.validate(to);\n\n\t\t// Bail if the sanitized value is null or unchanged.\n\t\tif (null === to || _.isEqual(from, to)) {\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Start Kirki mod.\n\t\t */\n\t\tif (this.id && api.control(this.id) && api.control(this.id).params && api.control(this.id).params.parent_setting) {\n\t\t\tparentSetting = api.control(this.id).params.parent_setting;\n\t\t\tnewVal = {};\n\t\t\tnewVal[this.id.replace(parentSetting + '[', '').replace(']', '')] = to;\n\t\t\tapi.control(parentSetting).setting.set(jQuery.extend({}, api.control(parentSetting).setting._value, newVal));\n\t\t}\n\n\t\t/**\n\t\t * End Kirki mod.\n\t\t */\n\n\t\tthis._value = to;\n\t\tthis._dirty = true;\n\n\t\tthis.callbacks.fireWith(this, [to, from]);\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * Get the value.\n\t *\n\t * @returns {mixed} - Returns the value.\n\t */\n\tapi.Value.prototype.get = function () {\n\n\t\t// Start Kirki mod.\n\t\tvar parentSetting;\n\t\tif (this.id && api.control(this.id) && api.control(this.id).params && api.control(this.id).params.parent_setting) {\n\t\t\tparentSetting = api.control(this.id).params.parent_setting;\n\t\t\treturn api.control(parentSetting).setting.get()[this.id.replace(parentSetting + '[', '').replace(']', '')];\n\t\t}\n\t\t// End Kirki mod.\n\n\t\treturn this._value;\n\t};\n}(wp.customize));\n"],"names":["api","wp","customize","kirkiDynamicControl","Control","extend","initialize","id","options","className","control","this","args","params","type","content","splits","split","jQuery","attr","replace","_","each","wrapper_atts","val","key","propertyElements","prototype","call","hooks","doAction","_setUpSettingRootLinks","container","find","node","data","setting","element","Element","elements","push","sync","set","_setUpSettingPropertyLinks","propertyName","bind","newPropertyValue","newSetting","clone","newValue","get","ready","deferred","embedded","done","initKirkiControl","embed","sectionId","section","expanded","settings","autofocus","actuallyEmbed","state","renderContent","resolve","focus","on","Value","to","parentSetting","newVal","from","_value","_setter","apply","arguments","validate","isEqual","parent_setting","_dirty","callbacks","fireWith"],"version":3,"file":"control.js.map"}