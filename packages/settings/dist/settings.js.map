{"mappings":"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","sources":["packages/settings/src/utils.ts","packages/settings/src/setup-udb.ts","jQuery.js","packages/settings/src/settings.ts","packages/settings/src/tabs.ts"],"sourcesContent":["export const getClosest = (\r\n\tel: HTMLElement,\r\n\tselector: string,\r\n\tdepth?: number\r\n): HTMLElement | undefined => {\r\n\tif (el.matches(selector)) {\r\n\t\treturn el;\r\n\t}\r\n\r\n\tif (el.tagName === \"BODY\" || el.tagName === \"HTML\") {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tlet closest = undefined;\r\n\tdepth = depth ? depth : 20;\r\n\r\n\tfor (let i = 0; i < depth; i++) {\r\n\t\tconst parentNode = el.parentNode as HTMLElement;\r\n\r\n\t\tif (\r\n\t\t\t!parentNode ||\r\n\t\t\tparentNode.tagName === \"BODY\" ||\r\n\t\t\tparentNode.tagName === \"HTML\"\r\n\t\t) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (parentNode.matches(selector)) {\r\n\t\t\treturn parentNode;\r\n\t\t}\r\n\r\n\t\tel = parentNode;\r\n\t}\r\n\r\n\treturn closest;\r\n};\r\n\r\nexport const startLoading = (button: HTMLButtonElement | HTMLElement) => {\r\n\tbutton.classList.add(\"is-loading\");\r\n};\r\n\r\nexport const stopLoading = (button: HTMLButtonElement | HTMLElement) => {\r\n\tbutton.classList.remove(\"is-loading\");\r\n};\r\n","import { getClosest, startLoading, stopLoading } from \"./utils\";\nimport jQuery from \"jquery\";\n\ndeclare var wp: any;\ndeclare var kirkiSettings: any;\ndeclare var ajaxurl: any;\n\nexport default function setupUdb() {\n\tconst adminPage: HTMLElement | null = document.querySelector(\n\t\t\".kirki-settings-page\"\n\t);\n\tif (!adminPage) return;\n\n\tlet doingAjax = false;\n\tconst udbData = kirkiSettings.recommendedPlugins.udb;\n\n\tdocument.addEventListener(\"click\", handleDocumentClick);\n\n\tfunction handleDocumentClick(e: Event) {\n\t\tconst button = getClosest(e.target as HTMLElement, \".kirki-install-udb\");\n\t\tif (!button) return;\n\n\t\te.preventDefault();\n\n\t\tif (\n\t\t\t!confirm(\n\t\t\t\t\"This will install and activate the Ultimate Dashboard plugin. Please don't leave this page until the installation is complete. Install now?\"\n\t\t\t)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tprepareUdb(button);\n\t}\n\n\tfunction disableOrEnableOtherButtons(\n\t\tactionType: string,\n\t\tcurrentButton: HTMLElement | HTMLButtonElement\n\t) {\n\t\tconst buttons = document.querySelectorAll(\".kirki-install-udb\");\n\t\tif (!buttons.length) return;\n\n\t\tbuttons.forEach((button) => {\n\t\t\tif (actionType === \"disable\") {\n\t\t\t\tif (currentButton && button === currentButton) return;\n\t\t\t}\n\n\t\t\tif (button.tagName.toLowerCase() === \"button\") {\n\t\t\t\tif (actionType === \"disable\") {\n\t\t\t\t\tbutton.setAttribute(\"disabled\", \"disabled\");\n\t\t\t\t} else {\n\t\t\t\t\tbutton.removeAttribute(\"disabled\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (actionType === \"disable\") {\n\t\t\t\t\tbutton.classList.add(\"is-disabled\");\n\t\t\t\t} else {\n\t\t\t\t\tbutton.classList.remove(\"is-disabled\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction prepareUdb(button: HTMLElement) {\n\t\tif (!adminPage) return;\n\t\tif (doingAjax) return;\n\t\tstartProcessing(button);\n\n\t\tconst nonce = adminPage.dataset.setupUdbNonce\n\t\t\t? adminPage.dataset.setupUdbNonce\n\t\t\t: \"\";\n\n\t\tjQuery\n\t\t\t.ajax({\n\t\t\t\turl: ajaxurl,\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tdata: {\n\t\t\t\t\taction: \"kirki_prepare_install_udb\",\n\t\t\t\t\tnonce: nonce,\n\t\t\t\t},\n\t\t\t})\n\t\t\t.done(function (response) {\n\t\t\t\tif (!response.success) {\n\t\t\t\t\talert(response.data);\n\t\t\t\t\tstopProcessing(button, \"\");\n\t\t\t\t}\n\n\t\t\t\tif (response.data.finished) {\n\t\t\t\t\tstopProcessing(button, udbData.redirectUrl);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdoingAjax = false;\n\t\t\t\tinstallUdb(button);\n\t\t\t\treturn;\n\t\t\t})\n\t\t\t.fail(function (jqXHR) {\n\t\t\t\tif (jqXHR.responseJSON && jqXHR.responseJSON.data) {\n\t\t\t\t\talert(jqXHR.responseJSON.data);\n\t\t\t\t}\n\n\t\t\t\tstopProcessing(button, \"\");\n\t\t\t});\n\t}\n\n\tfunction installUdb(button: HTMLElement) {\n\t\tif (doingAjax) return;\n\t\tdoingAjax = true;\n\n\t\twp.updates.installPlugin({\n\t\t\tslug: udbData.slug,\n\t\t\tsuccess: function () {\n\t\t\t\tdoingAjax = false;\n\t\t\t\tactivateUdb(button);\n\t\t\t},\n\t\t\terror: function (jqXHR: any) {\n\t\t\t\t// console.log(jqXHR);\n\n\t\t\t\tlet abort = true;\n\n\t\t\t\tif (jqXHR.errorCode && jqXHR.errorMessage) {\n\t\t\t\t\tif (jqXHR.errorCode === \"folder_exists\") {\n\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\"Plugin is already installed before, let's continue activating it.\"\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tdoingAjax = false;\n\t\t\t\t\t\tabort = false;\n\n\t\t\t\t\t\t// If the plugin is already installed, just activate it.\n\t\t\t\t\t\tactivateUdb(button);\n\t\t\t\t\t} else {\n\t\t\t\t\t\talert(jqXHR.errorMessage);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (jqXHR.responseJSON && jqXHR.responseJSON.data) {\n\t\t\t\t\t\talert(jqXHR.responseJSON.data);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (abort) {\n\t\t\t\t\tstopProcessing(button, \"\");\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tfunction activateUdb(button: HTMLElement) {\n\t\tif (doingAjax) return;\n\t\tdoingAjax = true;\n\n\t\tjQuery.ajax({\n\t\t\tasync: true,\n\t\t\ttype: \"GET\",\n\t\t\turl: udbData.activationUrl,\n\t\t\tsuccess: function () {\n\t\t\t\tstopProcessing(button, udbData.redirectUrl);\n\t\t\t},\n\t\t\terror: function (jqXHR) {\n\t\t\t\tif (jqXHR.responseJSON && jqXHR.responseJSON.data) {\n\t\t\t\t\talert(jqXHR.responseJSON.data);\n\t\t\t\t}\n\n\t\t\t\tstopProcessing(button, \"\");\n\t\t\t},\n\t\t});\n\t}\n\n\tfunction startProcessing(button: HTMLElement) {\n\t\tdoingAjax = true;\n\t\tdisableOrEnableOtherButtons(\"disable\", button);\n\t\tstartLoading(button);\n\t}\n\n\tfunction stopProcessing(button: HTMLElement, redirectUrl: string) {\n\t\tif (redirectUrl) {\n\t\t\twindow.location.replace(redirectUrl);\n\t\t}\n\n\t\tstopLoading(button);\n\t\tdoingAjax = false;\n\t\tdisableOrEnableOtherButtons(\"enable\", button);\n\t}\n}\n","module.exports=jQuery;","import \"./settings.scss\";\r\nimport setupUdb from \"./setup-udb\";\r\nimport setupTabsNavigation from \"./tabs\";\r\n\r\ndeclare var ajaxurl: string;\r\n\r\n(function () {\r\n\tsetupTabsNavigation();\r\n\tsetupUdb();\r\n\r\n\tconst metabox = document.querySelector(\".kirki-clear-font-cache-metabox\");\r\n\tif (!metabox) return;\r\n\r\n\tvar notice = metabox.querySelector(\".submission-status\");\r\n\tif (!notice) return;\r\n\r\n\tconst button = metabox.querySelector(\".kirki-clear-font-cache\");\r\n\tif (!button) return;\r\n\r\n\tbutton.addEventListener(\"click\", clearFontCache);\r\n\r\n\tlet doingAjax = false;\r\n\tlet timeoutId: number = 0;\r\n\r\n\tfunction clearFontCache(e: Event) {\r\n\t\tif (doingAjax) return;\r\n\t\tdoingAjax = true;\r\n\r\n\t\tconst button = this as HTMLButtonElement;\r\n\t\tbutton.classList.add(\"is-loading\");\r\n\r\n\t\tif (timeoutId) {\r\n\t\t\twindow.clearTimeout(timeoutId);\r\n\t\t}\r\n\r\n\t\ttimeoutId = 0;\r\n\r\n\t\tvar data = {\r\n\t\t\taction: \"kirki_clear_font_cache\",\r\n\t\t\tnonce: button.dataset.nonce,\r\n\t\t};\r\n\r\n\t\tjQuery\r\n\t\t\t.ajax({\r\n\t\t\t\turl: ajaxurl,\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: data,\r\n\t\t\t})\r\n\t\t\t.done(function (r) {\r\n\t\t\t\tshowNotice(r.success ? \"success\" : \"error\", r.data);\r\n\t\t\t})\r\n\t\t\t.fail(function (r) {\r\n\t\t\t\tshowNotice(\"error\", \"Something went wrong.\");\r\n\t\t\t})\r\n\t\t\t.always(function (r) {\r\n\t\t\t\tdoingAjax = false;\r\n\t\t\t\tbutton.classList.remove(\"is-loading\");\r\n\r\n\t\t\t\ttimeoutId = window.setTimeout(function () {\r\n\t\t\t\t\thideNotice();\r\n\t\t\t\t}, 4000);\r\n\t\t\t});\r\n\t}\r\n\r\n\tfunction showNotice(status: string, textContent: string) {\r\n\t\tif (!notice) return;\r\n\t\tnotice.textContent = textContent;\r\n\t\tnotice.classList.add(status === \"success\" ? \"is-success\" : \"is-error\");\r\n\t\tnotice.classList.remove(\"is-hidden\");\r\n\t}\r\n\r\n\tfunction hideNotice() {\r\n\t\tif (!notice) return;\r\n\t\tnotice.textContent = \"\";\r\n\t\tnotice.classList.remove(\"is-success\");\r\n\t\tnotice.classList.remove(\"is-error\");\r\n\t\tnotice.classList.add(\"is-hidden\");\r\n\t}\r\n})();\r\n","import jQuery from \"jquery\";\n\nexport default function setupTabsNavigation() {\n\tjQuery(\".heatbox-tab-nav-item\").on(\"click\", function () {\n\t\tjQuery(\".heatbox-tab-nav-item\").removeClass(\"active\");\n\t\tjQuery(this).addClass(\"active\");\n\n\t\tconst link = this.querySelector(\"a\");\n\t\tif (!link) return;\n\n\t\tif (link.href.indexOf(\"#\") === -1) return;\n\n\t\tconst hashValue = link.href.substring(link.href.indexOf(\"#\") + 1);\n\n\t\tjQuery(\".heatbox-panel-wrapper .heatbox-admin-panel\").css(\n\t\t\t\"display\",\n\t\t\t\"none\"\n\t\t);\n\n\t\tjQuery(\".heatbox-panel-wrapper .kirki-\" + hashValue + \"-panel\").css(\n\t\t\t\"display\",\n\t\t\t\"block\"\n\t\t);\n\t});\n\n\twindow.addEventListener(\"load\", function () {\n\t\tlet hashValue = window.location.hash.substring(1);\n\t\tlet currentActiveTabMenu: HTMLElement | null = null;\n\n\t\tif (!hashValue) {\n\t\t\tcurrentActiveTabMenu = document.querySelector(\n\t\t\t\t\".heatbox-tab-nav-item.active\"\n\t\t\t);\n\n\t\t\tif (currentActiveTabMenu && currentActiveTabMenu.dataset.tab) {\n\t\t\t\thashValue = currentActiveTabMenu.dataset.tab;\n\t\t\t}\n\n\t\t\thashValue = hashValue ? hashValue : \"settings\";\n\t\t}\n\n\t\tjQuery(\".heatbox-tab-nav-item\").removeClass(\"active\");\n\t\tjQuery(\".heatbox-tab-nav-item.kirki-\" + hashValue + \"-panel\").addClass(\n\t\t\t\"active\"\n\t\t);\n\n\t\tjQuery(\".heatbox-panel-wrapper .heatbox-admin-panel\").css(\n\t\t\t\"display\",\n\t\t\t\"none\"\n\t\t);\n\n\t\tjQuery(\".heatbox-panel-wrapper .kirki-\" + hashValue + \"-panel\").css(\n\t\t\t\"display\",\n\t\t\t\"block\"\n\t\t);\n\t});\n}\n"],"names":["$8f87dbd6e216f0fb$export$211731fc355e9121","el","selector","depth","matches","tagName","closest","i","parentNode","$8f87dbd6e216f0fb$export$fea330ef6103f535","button","classList","add","$8f87dbd6e216f0fb$export$4dabcd056c1d895c","remove","$ecc64c948bb2b13b$export$2e2bcd8739ae039","adminPage","document","querySelector","doingAjax","udbData","kirkiSettings","recommendedPlugins","udb","disableOrEnableOtherButtons","actionType","currentButton","buttons","querySelectorAll","length","forEach","toLowerCase","setAttribute","removeAttribute","activateUdb","$parcel$interopDefault","$0a2eb9defebd2c69$exports","ajax","async","type","url","activationUrl","success","stopProcessing","redirectUrl","error","jqXHR","responseJSON","data","alert","window","location","replace","addEventListener","e","target","preventDefault","confirm","startProcessing","nonce","dataset","setupUdbNonce","ajaxurl","method","action","done","response","finished","wp","updates","installPlugin","slug","abort","errorCode","errorMessage","console","log","installUdb","fail","prepareUdb","jQuery","on","removeClass","this","addClass","link","href","indexOf","hashValue","substring","css","hash","currentActiveTabMenu","tab","metabox","notice","timeoutId","clearTimeout","r","showNotice","always","setTimeout","textContent","hideNotice","status"],"version":3,"file":"settings.js.map"}